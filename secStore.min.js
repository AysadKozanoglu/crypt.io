/* https://github.com/jas-/secStore.js */
(function(e){e.fn.secStore=function(t){var n={appID:"secStore.js",storage:"local",uuid:"",data:{},aes:false,debug:false,callback:function(){},preCallback:function(){},errCallback:function(){}};var r=r||{init:function(e){var t=s.merge(e,n);return s.init(t)},empty:function(e){var t=s.merge(e,n);return s.empty(t)}};var s=s||{init:function(t){t.preCallback&&e.isFunction(t.preCallback)?t.preCallback(this):false;t.uuid=t.aes?u.key(t):t.uuid;var n=a.size(o.toJSON(t.data))>0?o.save(t,t.appID,t.data):o.retrieve(t,t.appID);t.callback&&e.isFunction(t.callback)?t.callback(n):false;return n},merge:function(t,n){return e.extend({},n,t)},empty:function(e){return o.empty(e,e.appID)}};var o=o||{quota:function(e,t,n){var r=/local|session/.test(t)?1024*1025*5:1024*4;var i=r-unescape(encodeURIComponent(JSON.stringify(t))).length;if(i<=0){f.error(e,"Maximum quota ("+r+"k) for "+t+" has been met, cannot continue");return false}n?f.debug(e,"_storage.quota: Maximum quota ("+r+"k) for "+t+" has not been met. Current total: "+i+"k"):false;return true},save:function(t,n,r){var i=false;if(o.quota(t.appID,t.storage,t.debug)){var s=o.retrieve(t,n);if(a.size(s)>0){e.extend(r,s)}r=t.aes?sjcl.encrypt(t.uuid,o.fromJSON(r)):o.fromJSON(r);switch(t.storage){case"cookie":this._cookie.save(t,n,r);i=true;break;case"local":this._local.save(t,n,r);i=true;break;case"session":this._session.save(t,n,r);i=true;break;default:this._local.save(t,n,r);i=true;break}}return i},retrieve:function(e,t){var n={};switch(e.storage){case"cookie":n=this._cookie.retrieve(e,t);break;case"local":n=this._local.retrieve(e,t);break;case"session":n=this._session.retrieve(e,t);break;default:n=this._local.retrieve(e,t);break}if(a.size(o.toJSON(n))>0){n=e.aes?sjcl.decrypt(e.uuid,n):n;return/string/.test(typeof n)?o.toJSON(n):n}e.debug?f.debug(e.appID,'_storage.retrieve: An error occured retrieving "'+t+'" from "'+e.storage+'"'):false;return false},empty:function(e,t){var n=false;switch(e.storage){case"cookie":this._cookie.empty(e,t);n=true;break;case"local":this._local.empty(e,t);n=true;break;case"session":this._session.empty(e,t);n=true;break;default:this._local.empty(e,t);n=true;break}return n},fromJSON:function(e){return/object/.test(typeof e)?JSON.stringify(e):e},toJSON:function(e){return/string/.test(typeof e)?JSON.parse(e):e},_cookie:{save:function(e,t,n){var r=new Date;r.setTime(r.getTime()+30*24*60*60*1e3);document.cookie=t+"="+n+";expires="+r.toGMTString()+";path=/;domain="+this.domain();e.debug?f.debug(e.appID,"_cookies.save: "+t+" => "+n):false;return true},retrieve:function(e,t){var n,r,i,s=document.cookie.split(";");for(n=0;n<s.length;n++){r=s[n].substr(0,s[n].indexOf("="));i=s[n].substr(s[n].indexOf("=")+1);r=r.replace(/^\s+|\s+$/g,"");if(r==t){e.debug?f.debug(e.appID,"_cookies.retrieve: "+t+" => "+i):false;return unescape(i)}}return false},domain:function(){return location.hostname},empty:function(e,t){var n=new Date;n.setTime(n.getTime()-30*24*60*60*1e3);document.cookie=t+"=null;expires="+n.toGMTString()+";path=/;domain="+this.domain();e.debug?f.debug(e.appID,"_cookies.empty: "+t):false;return true}},_local:{save:function(e,t,n){e.debug?f.debug(e.appID,"_local.save: "+t+" => "+n):false;return localStorage.setItem(t,n)},retrieve:function(e,t){var n=localStorage.getItem(t);e.debug?f.debug(e.appID,"_local.retrieve: "+t+" => "+n):false;return n?n:false},empty:function(e,t){var n=localStorage.removeItem(t);e.debug?f.debug(e.appID,"_local.empty: "+t):false;return n?n:false}},_session:{save:function(e,t,n){e.debug?f.debug(e.appID,"_session.save: "+t+" => "+n):false;return sessionStorage.setItem(t,n)},retrieve:function(e,t){var n=sessionStorage.getItem(t);e.debug?f.debug(e.appID,"_session.retrieve: "+t+" => "+n):false;return n?n:false},empty:function(e,t){var n=sessionStorage.removeItem(t);e.debug?f.debug(e.appID,"_session.empty: "+t):false;return n?n:false}}};var u=u||{key:function(e){e.debug?f.debug(e.appID,"_crypto.key: Prepared key"):false;var t=u.uid();return sjcl.codec.hex.fromBits(sjcl.misc.pbkdf2(t,u.salt(t),1e3,256))},uid:function(){var e=window.navigator.appName+window.navigator.appCodeName+window.navigator.product+window.navigator.productSub+window.navigator.appVersion+window.navigator.buildID+window.navigator.userAgent+window.navigator.language+window.navigator.platform+window.navigator.oscpu;return e.replace(/\s/,"")},salt:function(e){var t=u.iv(e);var n=[];n[0]=sjcl.hash.sha256.hash(e);var r=[];r=n[0];var s;for(i=1;i<3;i++){n[i]=sjcl.hash.sha256.hash(n[i-1].concat(t));s=r.concat(n[i])}return JSON.stringify(sjcl.codec.hex.fromBits(s))},iv:function(e){return e?encodeURI(e.replace(/-/gi,"").substring(16,Math.ceil(16*e.length)%e.length)):false}};var a=a||{inspect:function(t,n){e.each(n,function(e,n){if(/object|array/.test(typeof n)&&a.size(n)>0){t.debug?f.debug(t.appID,"_libs.inspect: Examining "+e+" ("+typeof n+")"):false;a.inspect(t,n)}else{t.debug?f.debug(t.appID,"_libs.inspect: "+e+" => "+n):false}})},size:function(t){var n=0;if(/object/.test(typeof t)){e.each(t,function(e,r){if(t.hasOwnProperty(e))n++})}else if(/array/.test(typeof t)){n=t.length}return n}};var f=f||{debug:function(e,t){return/function/.test(typeof console.debug)?console.debug("["+e+"] (DEBUG) "+t):false},info:function(e,t){return/function/.test(typeof console.info)?console.info("["+e+"] (INFO) "+t):false},warn:function(e,t){return/function/.test(typeof console.warn)?console.warn("["+e+"] (WARN) "+t):false},error:function(e,t){return/function/.test(typeof console.error)?console.error("["+e+"] (ERROR) "+t):false}};if(r[t]){return r[t].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return r.init.apply(this,arguments)}else{f.error("Method "+t+" does not exist")}return true}})(jQuery)
